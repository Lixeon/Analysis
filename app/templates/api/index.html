{% extends "form.html" %}

{% block styles %}
{{super()}}
<link rel="stylesheet" type="text/css" href="{{ url_for( 'static',filename='css/data.css' )}}">
{% endblock %}

{% block app_content %}
{% if api_list %}
<div class="table-responsive">
    <table class="table table-striped">
        <thead>{% if api_list[0]|length > 1 %}<tr>{% for key in api_list[0].keys() %}<th>{{ key }}</th>{% endfor %}</tr>{% endif %}</thead>
        <tbody>{% for api in api_list %}<tr>{% for k,v in api.items() %}<td>{% if k=='status' %}<span id="st-{{ api.id }}" class="badge badge-{{ v }}">{{ v }}</span>{% elif k=='control' %}<button type="button"  id="bt-{{ api.id }}" class="bt-c btn btn-info btn-rounded">Run</button>
        {% elif k=='info' %}<span id="if-{{ api.id }}" class="label label-default">{{ v }}</span>{% else %}{{ v }}{% endif %}</td>{% endfor %}</tr>{% endfor %}
        </tbody>
    </table>
</div>
{% endif %}
{% endblock %}

{% block scripts %}
{{ super() }}
<script>
    function GetMachInfo(id) {
        
        var $src = $('#bt-'+id);
        var $st = $('#st-'+id);
        var $if = $('#if-'+id);

        var $p = $src.parent()
        var $cp = $p.children();
        $src.html('<img src="{{ url_for('static', filename='images/loading/loading.gif') }}">');
        $.post("{{ url_for('api.index') }}", {
            "id": id,
            "machine": "shake"
        }).done(function (response) {
            $st.text(response['status']);
            $if.text(response['info']);
            $p.children().remove();
            $p.append($cp);
            
        }).fail(function () {
            $st.text('Close');
            $if.text('Error');
            $p.children().remove();
            $p.append($cp);
        });
    }
    $(function () {
        $('.bt-c').click(
            function(){
                var $id = $(this).attr('id').split('-')[1];
                GetMachInfo($id);
            }
        )
    });
</script>
{% endblock %}

